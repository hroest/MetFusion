<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:icecore="http://www.icefaces.org/icefaces/core"
	xmlns:ace="http://www.icefaces.org/icefaces/components"
	xmlns:ice="http://www.icesoft.com/icefaces/component">
<h:head>
	<title>MetFusion</title>
	<link rel="stylesheet" type="text/css"
		href="./xmlhttp/css/rime/rime.css" />
	<link rel="stylesheet" type="text/css"
		href="./css/styles.css" />
</h:head>
<h:body>
	<h:form id="form">
	<icecore:singleSubmit />	<!-- ICEfaces 2 option for partial submit of form/input values for storing/validation -->

		<div id="header">
<!--			<ui:include src="/WEB-INF/inc-content/header.xhtml"></ui:include>-->
		</div>

		<div id="top_connect">
			<ice:outputConnectionStatus displayHourglassWhenActive="true" showPopupOnDisconnect="true"/>
		</div>

		<div id="content">
			<ice:panelTabSet selectedIndex="#{appBean.selectedTab}">
				<ice:panelTab label="Spectrum Query">
				<div id="inputs" style="width: 100%;">
					<div id="sourceParams" style="border: 1px dashed silver; width: 65%; float: left;">
					<!-- stacking panel selector for spectral database -->
					<ice:panelGrid columns="3" rendered="true">
						<ice:outputLabel for="selectSpectralDB" value="Selected Spectral Database:"/>
						<ice:selectOneRadio id="selectSpectralDB" layout="lineDirection" required="true" value="#{appBean.selectedSpectralDB}">
							<f:selectItems value="#{appBean.availableSpectralDBsSI}"/>
						</ice:selectOneRadio>
					</ice:panelGrid>
					<ice:panelStack selectedPanel="#{appBean.selectedSpectralDB}">
				    	<ice:panelGroup id="massbankSettings" style="margin-left: 10px; margin-right: 10px;">
		    				<ice:outputLabel value="MassBank Parameters" style="text-decoration: underline;"></ice:outputLabel>
		    				<br/>
		    				<ice:outputLabel value="#{appBean.mblb.serverUrl}"/>
		    				<br/>
		    				<ice:panelGrid columns="3" style="margin-left: 10px; margin-right: 10px;">
		    					<ice:panelGroup id="lblMBDB" panelTooltip="lblMBDBTooltip">
		    						<ice:outputLabel value="MassBank Server:"/>
		    						<ice:panelTooltip id="lblMBDBTooltip">
		    							<f:facet name="header">
		    								<ice:outputText value="MassBank Server"></ice:outputText>
		    							</f:facet>
		    							<f:facet name="body">
		    								<ice:outputText value="Specify a MassBank server. Default is the japanese one
		    								at www.massbank.jp."></ice:outputText>
		    							</f:facet>
		    						</ice:panelTooltip>
		    					</ice:panelGroup>
		    					<ice:panelGroup>
		    						<ice:selectOneMenu valueChangeListener="#{appBean.mblb.changeDatabase}" value="#{appBean.mblb.selectedServer}">
		    							<f:selectItems itemLabel="#{n}" itemValue="#{n}" var="n" 
											value="#{appBean.mblb.availableServers}" />
		    						</ice:selectOneMenu>
		    						<ice:panelGroup effect="#{appBean.effectOutputText}" style="float: right;" 
		    							rendered="#{appBean.mblb.selectOtherServer}">
			    						<ice:inputText id="mbServerUrl" rendered="#{appBean.mblb.selectOtherServer}" 
			    							valueChangeListener="#{appBean.mblb.changeDatabase}" value="#{appBean.mblb.otherServer}"
			    							partialSubmit="true" immediate="true">
			    						</ice:inputText>
		    						</ice:panelGroup>
		    					</ice:panelGroup>
		    					<ice:panelGroup effect="#{appBean.effectOutputText}">
		    						<ice:message id="errmbServer" for="mbServer"></ice:message>
		    					</ice:panelGroup>
		    					
		    					<ice:panelGroup id="lblMBRslt" panelTooltip="lblMBRsltTooltip">
		    						<ice:outputLabel value="Number of Results:"></ice:outputLabel>
		    						<ice:panelTooltip id="lblMBRsltTooltip">
		    							<f:facet name="header">
		    								<ice:outputText value="Number of Results"></ice:outputText>
		    							</f:facet>
		    							<f:facet name="body">
		    								<ice:outputText value="Specify the maximum number of results.
		    								Allowed values are in the range of 1 to 500."></ice:outputText>
		    							</f:facet>
		    						</ice:panelTooltip>
		    					</ice:panelGroup>
		    					<ice:inputText id="mbResult" value="#{appBean.mblb.limit}" required="true" 
		    						requiredMessage="Please enter a number between 1 and 500.">
		    						<f:validateLongRange minimum="1" maximum="500"></f:validateLongRange>
		    					</ice:inputText>
		    					<ice:panelGroup effect="#{appBean.effectOutputText}">
		    						<ice:message id="errmbResult" for="mbResult"></ice:message>
		    					</ice:panelGroup>
		    					
		    					<ice:panelGroup id="lblMBCtff" panelTooltip="lblMBCtffTooltip">
		    						<ice:outputLabel value="Cutoff threshold of relative intensities:"></ice:outputLabel>
		    						<ice:panelTooltip id="lblMBCtffTooltip">
		    							<f:facet name="header">
		    								<ice:outputText value="Cutoff threshold of relative intensities"></ice:outputText>
		    							</f:facet>
		    							<f:facet name="body">
		    								<ice:outputText value="Defines the cutoff for small relative intensities.
		    								Allowed values lie in the range of 0 to 500."></ice:outputText>
		    							</f:facet>
		    						</ice:panelTooltip>
		    					</ice:panelGroup>
		    					<ice:inputText id="mbThresh" value="#{appBean.mblb.cutoff}" required="true" requiredMessage="Please enter a number between 0 and 500."
		    						validatorMessage="Please enter a number between 0 and 500.">
		    						<f:validateLongRange minimum="0" maximum="500"></f:validateLongRange>
		    					</ice:inputText>
		    					<ice:panelGroup effect="#{appBean.effectOutputText}">
		    						<ice:message id="errmbThresh" for="mbThresh"></ice:message>
		    					</ice:panelGroup>
		    					
		    					<ice:panelGroup id="lblMBIonMode" panelTooltip="lblMBIonModeTooltip">
		    						<ice:outputLabel value="Ionization Mode:"></ice:outputLabel>
		    						<ice:panelTooltip id="lblMBIonModeTooltip">
		    							<f:facet name="header">
		    								<ice:outputText value="Ionization Mode"></ice:outputText>
		    							</f:facet>
		    							<f:facet name="body">
		    								<ice:outputText value="Defines the ionization mode for the query spectrum.
		    								Allowed values are positive mode, negative mode and both modes."></ice:outputText>
		    							</f:facet>
		    						</ice:panelTooltip>
		    					</ice:panelGroup>
		    					<ice:panelGroup id="massbankIon">
									<ice:selectOneMenu id="allIon" value="#{appBean.mblb.selectedIon}" partialSubmit="true" required="true"
										valueChangeListener="#{appBean.changeIonizationListener}">
										<f:selectItems itemLabel="#{n}" itemValue="#{n}" var="n" 
											value="#{appBean.mblb.ionisations}" />
									</ice:selectOneMenu>
								</ice:panelGroup>
								<ice:panelGroup effect="#{appBean.effectOutputText}">
		    						<ice:message id="errallIon" for="allIon"></ice:message>
		    					</ice:panelGroup>
		    				</ice:panelGrid>
		    				
		    				<ice:panelGroup id="msgMassBank" rendered="#{appBean.mblb.brokenMassBank}"
		    					style="border: 1px solid DarkRed; background-color: MistyRose; margin: 5px;">
		    					Not all MassBank servers could be reached! Current queries will possible yield less results
		    					than expected/normal. Either proceed or try again later. You may also want to check 
		    					<a href="http://www.massbank.jp/">MassBank.jp</a> for further details.
		    				</ice:panelGroup>
							
							<ice:panelGroup style="margin-left: 10px; margin-right: 10px;">
								<ice:panelGrid columns="2" columnClasses="gridSelectItems">
									<ice:panelGroup id="lblMBInstruments" panelTooltip="lblMBInstrumentsTooltip">
										<ice:outputLabel value="Instruments:"></ice:outputLabel>
										<ice:panelTooltip id="lblMBInstrumentsTooltip">
			    							<f:facet name="header">
			    								<ice:outputText value="Instruments"></ice:outputText>
			    							</f:facet>
			    							<f:facet name="body">
			    								<ice:outputText value="Select the instruments or groups used for lookup of the
			    								query spectrum. At least one selected instrument is required! Instruments are
			    								separated into groups EI, ESI and Other."></ice:outputText>
			    							</f:facet>
		    							</ice:panelTooltip>
									</ice:panelGroup>
									<ice:panelGrid columns="#{appBean.mblb.NUM_INST_GROUPS}" columnClasses="gridSelectItems" id="instruments"
										style="text-align: left; margin-left: 187px; border: 1px dotted silver;">
										<ice:panelGroup rendered="#{appBean.mblb.presentEI}">
<!--											<ice:outputLabel value="EI"/>-->
<!--											<ice:selectBooleanCheckbox label="EI" value="#{appBean.mblb.useEIOnly}" style="margin-left: 5px;"-->
<!--												valueChangeListener="#{appBean.mblb.toggleInstrumentsEI}">-->
<!--												<f:param name="group" value="EI"/>-->
<!--											</ice:selectBooleanCheckbox>-->
											<ice:commandLink value="#{appBean.mblb.linkGroupEI}" actionListener="#{appBean.mblb.toggleInstrumentGroup}"
												style="color: LimeGreen; text-decoration: underline;" immediate="false">
												<!-- provide a parameter for the actionListener to differentiate the groups -->
												<f:param value="#{appBean.mblb.getEi()}" name="group"/>
											</ice:commandLink>
										</ice:panelGroup>
										<ice:panelGroup rendered="#{appBean.mblb.presentESI}">
<!--											<ice:outputLabel value="ESI"/>-->
<!--											<ice:selectBooleanCheckbox label="ESI" value="#{appBean.mblb.useESIOnly}" style="margin-left: 5px;"-->
<!--												valueChangeListener="#{appBean.mblb.toggleInstrumentsESI}">-->
<!--												<f:param name="group" value="ESI"/>-->
<!--											</ice:selectBooleanCheckbox>-->
											<ice:commandLink value="#{appBean.mblb.linkGroupESI}" actionListener="#{appBean.mblb.toggleInstrumentGroup}"
												style="color: LimeGreen; text-decoration: underline;" immediate="false">
												<!-- provide a parameter for the actionListener to differentiate the groups -->
												<f:param value="#{appBean.mblb.getEsi()}" name="group"/>
											</ice:commandLink>
										</ice:panelGroup>
										<ice:panelGroup rendered="#{appBean.mblb.presentOther}">
<!--											<ice:outputLabel value="Other"/>-->
<!--											<ice:selectBooleanCheckbox label="Other" value="#{appBean.mblb.useOtherOnly}" style="margin-left: 5px;">-->
<!--												valueChangeListener="#{appBean.mblb.toggleInstrumentsOther}">-->
<!--												<f:param name="group" value="Other"/>-->
<!--											</ice:selectBooleanCheckbox>-->
											<ice:commandLink value="#{appBean.mblb.linkGroupOTHER}" actionListener="#{appBean.mblb.toggleInstrumentGroup}"
												style="color: LimeGreen; text-decoration: underline;" immediate="false">
												<!-- provide a parameter for the actionListener to differentiate the groups -->
												<f:param value="#{appBean.mblb.getOther()}" name="group"/>
											</ice:commandLink>
										</ice:panelGroup>
										
										<!-- Select instruments of group EI -->
										<ice:selectManyCheckbox layout="pageDirection" value="#{appBean.mblb.selectedGroupInstruments[appBean.mblb.indexEI]}"
											valueChangeListener="#{appBean.mblb.changeInstruments}" immediate="true"
											rendered="#{appBean.mblb.presentEI}">
<!--											validator="de.ipbhalle.metfusion.web.controller.validation.InstrumentValidator">-->
											<f:selectItems value="#{appBean.mblb.instTest[appBean.mblb.indexEI]}"/>
											<f:attribute name="attrGroup" value="#{appBean.mblb.getEi()}"/>
										</ice:selectManyCheckbox>
										
										<!-- Select instruments of group ESI -->
										<ice:selectManyCheckbox layout="pageDirection" value="#{appBean.mblb.selectedGroupInstruments[appBean.mblb.indexESI]}"
											valueChangeListener="#{appBean.mblb.changeInstruments}" immediate="true"
											rendered="#{appBean.mblb.presentESI}">
<!--											validator="de.ipbhalle.metfusion.web.controller.validation.InstrumentValidator">-->
											<f:selectItems value="#{appBean.mblb.instTest[appBean.mblb.indexESI]}"/>
											<f:attribute name="attrGroup" value="#{appBean.mblb.getEsi()}"/>
										</ice:selectManyCheckbox>
										
										<!-- Select instruments of group Other -->
										<ice:selectManyCheckbox layout="pageDirection" value="#{appBean.mblb.selectedGroupInstruments[appBean.mblb.indexOther]}"
											valueChangeListener="#{appBean.mblb.changeInstruments}" immediate="true"
											rendered="#{appBean.mblb.presentOther}">
<!--											validator="de.ipbhalle.metfusion.web.controller.validation.InstrumentValidator">-->
											<f:selectItems value="#{appBean.mblb.instTest[appBean.mblb.indexOther]}"/>
											<f:attribute name="attrGroup" value="#{appBean.mblb.getOther()}"/>
										</ice:selectManyCheckbox>
									</ice:panelGrid>
								</ice:panelGrid>
							</ice:panelGroup>
							
							<ice:panelGroup>
								<ice:message id="errMsgInst" for="instruments"/>
								<ice:messages id="errMsgs" style="background-color: Orange;"/>
							</ice:panelGroup>
							
				    	</ice:panelGroup>

						<ice:panelGroup id="gmdSettings">
						gmd selected
						</ice:panelGroup>
				    	
				    	<ice:panelGroup id="metlinSettings">
					    	<ice:panelGrid id="metlinParameters" columns="3">
					    	
					    		<ice:outputLabel for="metlinMode" value="Ionization Mode:"/>
					    		<ice:selectOneRadio id="metlinMode" required="true" value="#{metlinBean.selectedIonization}">
					    			<f:selectItem itemLabel="positive" itemValue="pos"/>
					    			<f:selectItem itemLabel="negative" itemValue="neg"/>
					    		</ice:selectOneRadio>
					    		<ice:panelGroup effect="#{appBean.effectOutputText}">
					    			<ice:message for="metlinMode"/>
					    		</ice:panelGroup>
					    		
					    		<ice:outputLabel for="metlinColEnergy" value="Collision Energy:"/>
					    		<ice:selectOneMenu id="metlinColEnergy" required="true" value="#{metlinBean.collisionEnergy}">
					    			<f:selectItem itemLabel="10 eV" itemValue="10"/>
					    			<f:selectItem itemLabel="20 eV" itemValue="20"/>
					    			<f:selectItem itemLabel="40 eV" itemValue="40"/>
					    		</ice:selectOneMenu>
					    		<ice:panelGroup effect="#{appBean.effectOutputText}">
					    			<ice:message for="metlinColEnergy"/>
					    		</ice:panelGroup>
					    		
					    		<ice:outputLabel for="metlinToleranceMSMS" value="Tolerance MSMS (Da):"/>
					    		<ice:inputText id="metlinToleranceMSMS" required="true" value="#{metlinBean.toleranceMSMS}">
					    			<f:validateDoubleRange minimum="0.001" maximum="0.5"/>
					    		</ice:inputText>
					    		<ice:panelGroup effect="#{appBean.effectOutputText}">
					    			<ice:message for="metlinToleranceMSMS"/>
					    		</ice:panelGroup>
					    		
					    		<ice:outputLabel for="metlinTolerancePrecursor" value="Tolerance Precursor (ppm):"/>
					    		<ice:inputText id="metlinTolerancePrecursor" required="true" value="#{metlinBean.tolerancePrecursor}">
					    			<f:validateLongRange minimum="1" maximum="100"/>
					    		</ice:inputText>
					    		<ice:panelGroup effect="#{appBean.effectOutputText}">
					    			<ice:message for="metlinTolerancePrecursor"/>
					    		</ice:panelGroup>
					    		
					    	</ice:panelGrid>
				    	</ice:panelGroup>
				    	
				    	</ice:panelStack>
				    	<br/>
				    	<ice:panelGroup style="margin-left: 10px; margin-right: 10px; clear: both;">
				    		<ice:outputLabel value="MetFrag Parameters" style="text-decoration: underline;"/>
				    		<ice:panelGroup effect="#{appBean.effectNote}" style="float: right;">
			    				<ice:outputText style="margin-left: 10px; color: Orange;" value="#{appBean.metfragModeSetting}" escape="false"/>
			    			</ice:panelGroup>
				    		<br/>
				    		<ice:panelGrid columns="3" columnClasses="labels, text, errors" style="margin-left: 10px; margin-right: 10px;">
				    			
				    			<!-- Select MetFrag upstream database -->
				    			<ice:panelGroup id="lblMFDatabase" panelTooltip="lblMFDatabaseTooltip">
									<ice:outputLabel for="metfragDatabases" value="Upstream DB:"></ice:outputLabel>
									<ice:panelTooltip id="lblMFDatabaseTooltip">
		    							<f:facet name="header">
		    								<ice:outputText value="Upstream Database"></ice:outputText>
		    							</f:facet>
		    							<f:facet name="body">
		    								<ice:outputText value="Select the compound database to query. A choice is required!
		    								Possible choices include KEGG, PubChem and ChemSpider."></ice:outputText>
		    							</f:facet>
	    							</ice:panelTooltip>
								</ice:panelGroup>
								<ice:selectOneRadio value="#{appBean.mfb.selectedDB}" id="metfragDatabases"
										partialSubmit="true" required="true" valueChangeListener="#{appBean.mfb.changeDatabase}">
									<f:selectItems itemLabel="#{n.label}" itemValue="#{n.value}" var="n" 
										value="#{appBean.mfb.databases}" />
								</ice:selectOneRadio>
								<ice:panelGroup effect="#{appBean.effectOutputText}">
									<ice:message id="errmetfragDatabases" for="metfragDatabases"></ice:message>
								</ice:panelGroup>
								
								<!-- SDF upload controls -->
								<ice:panelGroup id="lblMFSDF" panelTooltip="lblMFSDFTooltip" rendered="#{appBean.mfb.renderSDF}">
									<ice:outputLabel for="dbSDF" value="SDF Upload:"/>
									<ice:panelTooltip id="lblMFSDFTooltip">
		    							<f:facet name="header">
		    								<ice:outputText value="SDF Upload"></ice:outputText>
		    							</f:facet>
		    							<f:facet name="body">
		    								<ice:outputText value="Controls for SDF upload."></ice:outputText>
		    							</f:facet>
	    							</ice:panelTooltip>
								</ice:panelGroup>
								<ice:panelGroup rendered="#{appBean.mfb.renderSDF}">
<!--									<ace:fileEntry id="fileEntrySDF" callback="#{fileMD5EncodingCallback}" rendered="#{appBean.mfb.renderSDF}" />-->
									<ace:fileEntry id="fileEntryComp" label="SDF Upload" relativePath="temp" useSessionSubdir="true"
									fileEntryListener="#{appBean.mfb.listener}" useOriginalFilename="true" 
									maxFileCount="1" maxFileCountMessage="Only one file per upload allowed!">
<!--										<f:validator for="fileEntryComp" validatorId="uploadValidator"/>-->
									</ace:fileEntry>
<!--									<h:commandButton value="Upload SDF" action="#{appBean.mfb.upload}"/>-->
								</ice:panelGroup>
								<ice:panelGroup effect="#{appBean.effectOutputText}" rendered="#{appBean.mfb.renderSDF}">
									<ice:message id="errdbSDF" for="dbSDF"/>
									<ice:outputText rendered="#{!appBean.mfb.validSDF}" value="#{appBean.mfb.noteSDF}"
										style="color: Orange;"></ice:outputText>
								</ice:panelGroup>
								
								<!-- provide database identifiers -->
								<ice:panelGroup id="lblMFDBID" panelTooltip="lblMFDBIDTooltip" rendered="#{!appBean.mfb.renderSDF}">
									<ice:outputLabel for="dbID" value="Database IDs:"></ice:outputLabel>
									<ice:panelTooltip id="lblMFDBIDTooltip">
		    							<f:facet name="header">
		    								<ice:outputText value="Database IDs"></ice:outputText>
		    							</f:facet>
		    							<f:facet name="body">
		    								<ice:outputText value="Optionally provide known comma-separated list of 
		    									database identifiers for the selected compound database. 
		    									Only provided identifiers are used for the query! "></ice:outputText>
		    							</f:facet>
	    							</ice:panelTooltip>
								</ice:panelGroup>
								<ice:inputText id="dbID" value="#{appBean.mfb.databaseID}" rendered="#{!appBean.mfb.renderSDF}"></ice:inputText>
								<ice:panelGroup effect="#{appBean.effectOutputText}" rendered="#{!appBean.mfb.renderSDF}">
									<ice:message id="errdbID" for="dbID"></ice:message>
								</ice:panelGroup>
								
								<!-- provide molecular formula, e.g. C6H12O6 -->
								<ice:panelGroup id="lblMFSumFormula" panelTooltip="lblMFSumFormulaTooltip" rendered="#{!appBean.mfb.renderSDF}">
									<ice:outputLabel for="sumFormula" value="Molecular Formula:"></ice:outputLabel>
									<ice:panelTooltip id="lblMFSumFormulaTooltip">
		    							<f:facet name="header">
		    								<ice:outputText value="Molecular Formula"></ice:outputText>
		    							</f:facet>
		    							<f:facet name="body">
		    								<ice:outputText value="Optionally provide one known molecular formula.
		    									An example would be C6H12O6."></ice:outputText>
		    							</f:facet>
	    							</ice:panelTooltip>
								</ice:panelGroup>
								<ice:inputText id="sumFormula" value="#{appBean.mfb.molecularFormula}" rendered="#{!appBean.mfb.renderSDF}"
									valueChangeListener="#{appBean.mfb.changeFormula}"></ice:inputText>
								<ice:panelGroup effect="#{appBean.effectOutputText}" rendered="#{!appBean.mfb.renderSDF}">
									<ice:message id="errsumFormula" for="sumFormula"></ice:message>
								</ice:panelGroup>
								
								<!-- specify the mass of the parent ion and adduct -->
								<ice:panelGroup id="lblMFParentIon" panelTooltip="lblMFParentIonTooltip" rendered="#{!appBean.mfb.renderSDF}">
									<ice:outputLabel for="parentIon" value="Parent Ion:" style=""></ice:outputLabel>
									<ice:panelTooltip id="lblMFParentIonTooltip">
		    							<f:facet name="header">
		    								<ice:outputText value="Parent Ion"></ice:outputText>
		    							</f:facet>
		    							<f:facet name="body">
		    								<ice:outputText value="Calculated mass of the parent ion. First provide the mass of the ion, 
		    									then select which type of ion it is in order to calculate the corresponding exact mass."></ice:outputText>
		    							</f:facet>
	    							</ice:panelTooltip>
								</ice:panelGroup>
								<ice:panelGroup rendered="#{!appBean.mfb.renderSDF}">
									<ice:inputText id="parentIon" value="#{appBean.mfb.parentIon}" partialSubmit="true" required="true"									
										validatorMessage="Value is not between 10 and 10000.0" valueChangeListener="#{appBean.mfb.changeParentIon}"
										disabled="#{appBean.mfb.viaFormula}">
										<f:validateDoubleRange minimum="10.0" maximum="10000.0"/>
									</ice:inputText>
									<ice:selectOneMenu id="selectAdduct" valueChangeListener="#{appBean.mfb.changeAdduct}"
										value="#{appBean.mfb.selectedAdduct}" disabled="#{appBean.mfb.viaFormula}">
										<f:selectItems value="#{appBean.mfb.adductList}" var="adduct"
											itemLabel="#{adduct.label}" itemValue="#{adduct.value}"/>
									</ice:selectOneMenu>
								</ice:panelGroup>
								<ice:panelGroup effect="#{appBean.effectOutputText}" rendered="#{!appBean.mfb.renderSDF}">
									<ice:message id="errparentIon" for="parentIon"></ice:message>
								</ice:panelGroup>
								
								<!-- show the computed exact mass of the precursor molecule -->
								<ice:panelGroup id="lblMFExactMass" panelTooltip="lblMFExactMassTooltip" rendered="#{!appBean.mfb.renderSDF}">
									<ice:outputLabel for="exactMass" value="Exact Mass:" style=""></ice:outputLabel>
									<ice:panelTooltip id="lblMFExactMassTooltip">
		    							<f:facet name="header">
		    								<ice:outputText value="Exact Mass"></ice:outputText>
		    							</f:facet>
		    							<f:facet name="body">
		    								<ice:outputText value="Required exact mass for candidate of interest. For metabolomic scope,
		    									it ranges from 1 to 10000."></ice:outputText>
		    							</f:facet>
	    							</ice:panelTooltip>
								</ice:panelGroup>
								<ice:inputText id="exactMass" value="#{appBean.mfb.exactMass}" partialSubmit="true" required="true"
									validatorMessage="Value is not between 10 and 10000.0" disabled="true" style="color: ForestGreen;"
									rendered="#{!appBean.mfb.renderSDF}">
<!--									effect="#{appBean.effectOutputText}"-->
									<f:validateDoubleRange minimum="10.0" maximum="10000.0"></f:validateDoubleRange>
								</ice:inputText>
								<ice:panelGroup effect="#{appBean.effectOutputText}" rendered="#{!appBean.mfb.renderSDF}">
									<ice:message id="errexactMass" for="exactMass"></ice:message>
								</ice:panelGroup>
								
								<!-- limit the number of MetFrag results -->
								<ice:panelGroup id="lblMFLimit" panelTooltip="lblMFLimitTooltip" rendered="#{!appBean.mfb.renderSDF}">
									<ice:outputLabel for="candLimit" value="Limit # of Structures:"></ice:outputLabel>
									<ice:panelTooltip id="lblMFLimitTooltip">
		    							<f:facet name="header">
		    								<ice:outputText value="Limit # of Structures"></ice:outputText>
		    							</f:facet>
		    							<f:facet name="body">
		    								<ice:outputText value="Required maximum value of candidates. The limit
		    									ranges from 1 to 10000."></ice:outputText>
		    							</f:facet>
	    							</ice:panelTooltip>
								</ice:panelGroup>
								<ice:inputText id="candLimit" value="#{appBean.mfb.limit}" rendered="#{!appBean.mfb.renderSDF}"
									validatorMessage="Please enter a number between 1 and 10000.">
									<f:validateLongRange minimum="1" maximum="10000" for="candLimit"></f:validateLongRange>
								</ice:inputText>
								<ice:panelGroup effect="#{appBean.effectOutputText}" rendered="#{!appBean.mfb.renderSDF}">
									<ice:message id="errcandLimit" for="candLimit"></ice:message>
								</ice:panelGroup>
								
								<!-- specify biological (C,H,N,O,P,S) compounds only or not -->
								<ice:panelGroup id="lblMFchnops" panelTooltip="lblMFchnopsTooltip" rendered="#{!appBean.mfb.renderSDF}">
									<ice:outputLabel for="chnopsOnly" value="C,H,N,O,P,S only?"></ice:outputLabel>
									<ice:panelTooltip id="lblMFchnopsTooltip">
										<f:facet name="header">
											<ice:outputText value="Retrieve only biological compounds"></ice:outputText>
										</f:facet>
										<f:facet name="body">
											<ice:outputText value="Specify if only compounds that contain C,H,N,O,P and S 
											are considered (check), or not (uncheck)."></ice:outputText>
										</f:facet>
									</ice:panelTooltip>
								</ice:panelGroup>
								<ice:selectBooleanCheckbox id="chnopsOnly" value="#{appBean.mfb.onlyCHNOPS}" rendered="#{!appBean.mfb.renderSDF}"/>
								<ice:panelGroup effect="#{appBean.effectOutputText}" rendered="#{!appBean.mfb.renderSDF}">
									<ice:message id="errchnopsOnly" for="chnopsOnly"></ice:message>
								</ice:panelGroup>
								
								<!-- specify search ppm parameter -->
								<ice:panelGroup id="lblMFSeachPPM" panelTooltip="lblMFSeachPPMTooltip" rendered="#{!appBean.mfb.renderSDF}">
									<ice:outputLabel for="searchppm" value="Search PPM:"></ice:outputLabel>
									<ice:panelTooltip id="lblMFSeachPPMTooltip">
		    							<f:facet name="header">
		    								<ice:outputText value="Search PPM"></ice:outputText>
		    							</f:facet>
		    							<f:facet name="body">
		    								<ice:outputText value="Required deviation for exact mass lookup. 
		    								Usually, this value should not exceed 30 ppm as this would lead to much more candidates.
		    								The allowed range is between 0.0 and 100. This value depends on the mass 
		    								accuracy of the used MS device."></ice:outputText>
		    							</f:facet>
	    							</ice:panelTooltip>
								</ice:panelGroup>
								<ice:inputText id="searchppm" value="#{appBean.mfb.searchppm}" partialSubmit="true" required="true"
									validatorMessage="Value is not between 0 and 100.0" rendered="#{!appBean.mfb.renderSDF}">
									<f:validateDoubleRange minimum="0.0" maximum="100.0" for="searchppm"/>
								</ice:inputText>
								<ice:panelGroup effect="#{appBean.effectOutputText}" rendered="#{!appBean.mfb.renderSDF}">
									<ice:message id="errsearchppm" for="searchppm"></ice:message>
								</ice:panelGroup>
								
								<!-- specify mz abs parameter -->
								<ice:panelGroup id="lblMFMZabs" panelTooltip="lblMFMZabsTooltip">
									<ice:outputLabel for="mzabs" value="mz abs:"></ice:outputLabel>
									<ice:panelTooltip id="lblMFMZabsTooltip">
		    							<f:facet name="header">
		    								<ice:outputText value="mz abs"></ice:outputText>
		    							</f:facet>
		    							<f:facet name="body">
		    								<ice:outputText value="Required absolute deviation of fragment peaks that should be matched. 
		    								Usually, this value should be fairly small (less than 1). The allowed range is between 0.0 and 100.">
		    								</ice:outputText>
		    							</f:facet>
	    							</ice:panelTooltip>
								</ice:panelGroup>
								<ice:inputText id="mzabs" value="#{appBean.mfb.mzabs}" partialSubmit="true" required="true"
									validatorMessage="Value is not between 0 and 100.0">
									<f:validateDoubleRange minimum="0.0" maximum="100.0" for="mzabs"/>
								</ice:inputText>
								<ice:panelGroup effect="#{appBean.effectOutputText}">
									<ice:message id="errmzabs" for="mzabs"></ice:message>
								</ice:panelGroup>
								
								<!-- specify mz ppm parameter -->
								<ice:panelGroup id="lblMFMZppm" panelTooltip="lblMFMZppmTooltip">
									<ice:outputLabel for="mzppm" value="mz ppm:"></ice:outputLabel>
									<ice:panelTooltip id="lblMFMZppmTooltip">
		    							<f:facet name="header">
		    								<ice:outputText value="mz ppm"></ice:outputText>
		    							</f:facet>
		    							<f:facet name="body">
		    								<ice:outputText value="Required relative deviation of fragment peaks that should be matched. 
		    								Usually, this value should be fairly small (less than 30). The allowed range is between 0.0 and 100.
		    								This value depends on the mass accuracy of the used MS device.">
		    								</ice:outputText>
		    							</f:facet>
	    							</ice:panelTooltip>
								</ice:panelGroup>
								<ice:inputText id="mzppm" value="#{appBean.mfb.mzppm}" partialSubmit="true" required="true"
									validatorMessage="Value is not between 0 and 100.0">
									<f:validateDoubleRange minimum="0.0" maximum="100.0" for="mzppm"/>
								</ice:inputText>
								<ice:panelGroup effect="#{appBean.effectOutputText}">
									<ice:message id="errmzppm" for="mzppm"></ice:message>
								</ice:panelGroup>
							</ice:panelGrid>
							
				    	</ice:panelGroup>
			    	</div>
			    	
			    	<div id="fusionParams" style=" padding: 0 1em; border: 1px dashed silver; width: 30%; float: right;">
				    	<ice:panelGroup>
				    		<ice:outputLabel value="MetFusion Parameters" style="text-decoration: underline;"></ice:outputLabel>
				    		<br/>
				    		<ice:panelGrid columns="2" style="margin-left: 10px; margin-right: 10px;">
				    			<ice:panelGroup id="lblMetFusionCluster" panelTooltip="lblMetFusionClusterTooltip">
					    			<ice:outputLabel for="SlctClstr" value="Tanimoto Clustering:" style="line-height:200%"></ice:outputLabel>
					    			<ice:panelTooltip id="lblMetFusionClusterTooltip">
		    							<f:facet name="header">
		    								<ice:outputText value="Tanimoto Clustering"></ice:outputText>
		    							</f:facet>
		    							<f:facet name="body">
		    								<ice:outputText value="deprecated - Optionally choose if clustering should be 
		    									applied to results. As only clustered results are provided, this is redundant.">
		    								</ice:outputText>
		    							</f:facet>
	    							</ice:panelTooltip>
					    		</ice:panelGroup>
								<ice:selectBooleanCheckbox id="SlctClstr" partialSubmit="true" value="#{appBean.useClustering}" disabled="true"/>
		    					
		    					<ice:panelGroup id="lblMetFusionFilter" panelTooltip="lblMetFusionFilterTooltip">
					    			<ice:outputLabel for="SlctFltr" value="Filter Unique:" style="line-height:200%"></ice:outputLabel>
					    			<ice:panelTooltip id="lblMetFusionFilterTooltip">
		    							<f:facet name="header">
		    								<ice:outputText value="InChI-based Filtering"></ice:outputText>
		    							</f:facet>
		    							<f:facet name="body">
		    								<ice:outputText value="Optionally choose if results shall be filtered. This step removes 
		    								steroeisomeric compounds from MetFrag and duplicate spectra from MassBank.">
		    								</ice:outputText>
		    							</f:facet>
	    							</ice:panelTooltip>
					    		</ice:panelGroup>
								<ice:selectBooleanCheckbox id="SlctFltr" partialSubmit="true" value="#{appBean.useInChIFiltering}"/>
		    					
		    					<ice:panelGroup id="lblMetFusionPeaks" panelTooltip="lblMetFusionPeaksTooltip">
		    						<ice:outputLabel value="Peaks:"></ice:outputLabel>
		    						<ice:panelTooltip id="lblMetFusionPeaksTooltip">
		    							<f:facet name="header">
		    								<ice:outputText value="Peaks"></ice:outputText>
		    							</f:facet>
		    							<f:facet name="body">
		    								<ice:outputText value="Each peak and its intensity (separated by space/tab) one line: 
		    								[m/z] [intensity] e.g.: 119.051 467.616.">
		    								</ice:outputText>
		    							</f:facet>
	    							</ice:panelTooltip>
		    					</ice:panelGroup>
		    					<ice:inputTextarea id="allPeaks" value="#{appBean.inputSpectrum}"
				                               cols="20" rows="7" partialSubmit="true" required="true"
				                               style="width:280px;height:240px;overflow: auto;" immediate="false">
				            		<f:validator validatorId="spectrumValidator"/>
									<f:converter converterId="de.ipbhalle.metfusion.web.controller.validation.SpectrumConverter"/>
								</ice:inputTextarea>
	    					</ice:panelGrid>
	    					<ice:panelGroup effect="#{appBean.effectOutputText}">
	    						<ice:message id="errallPeaks" for="allPeaks" style="font-color: red;"></ice:message>
							</ice:panelGroup>
				    	</ice:panelGroup>
			    	</div>
			    	
			    	<div style=" padding: 0 1em; border: 1px dotted silver; width: 30%; float: right; margin-top: 5px;">
				    	<ice:panelGroup id="progressDatabase" effect="#{appBean.effect}" visible="false">
							<ice:outputProgress id="progressDatabaseSearch" value="#{databaseBean.searchProgress}" 
								label="MassBank retrieval: #{databaseBean.searchProgress}%"	labelComplete="MassBank retrieval done!"/>
							<ice:outputProgress id="progressFragmenterSearch" value="#{fragmenterBean.progress}" 
								label="MetFrag retrieval: #{fragmenterBean.progress}%" labelComplete="MetFrag retrieval done!"/>
						</ice:panelGroup>
						<ice:panelGroup>
<!--							<ice:commandButton value="Start" action="#{appBean.runThreadedVersion}" disabled="#{!appBean.enableStart}"/>-->
<!--							<ice:commandButton id="reset" value="Reset" actionListener="#{appBean.reset}"></ice:commandButton>-->
							<ice:outputProgress id="progressGlobal" value="#{appBean.percentProgressGlobal}" 
								label="MetFusion Progress: #{appBean.status} - #{appBean.percentProgressGlobal}%" labelComplete="Global done!"/>
							<ice:outputProgress indeterminate="true" label="running..." value="#{appBean.percentProgressGlobal}"/>
						</ice:panelGroup>
					</div>
			    </div>
			    	
			    	<!-- application control start and reset -->
			    	<div id="command" style="clear: both; float: left;">
			    		<h:commandButton value="Start" action="#{appBean.runThreadedVersion}" disabled="#{!appBean.enableStart}"/>
<!--				    	<ice:commandButton id="start" value="Start" action="#{appBean.runBoth}"></ice:commandButton>-->
<!--				   actionListener="#{appBean.runBoth}" 	-->
<!--						<ice:commandButton value="Stop" action="#{appBean.stopExecution}" rendered="#{!appBean.enableStart}"/>-->
				    	<ice:commandButton id="reset" value="Reset" actionListener="#{appBean.reset}"></ice:commandButton>
				    	<ice:message id="emptyResults" for="start"/>
			    	</div>
			    	
			    	<!-- feedback admin login and editing -->
			    	<div id="feedbackAdmin">
						<ice:commandLink id="openFeedbackAdminForm" value="Feedback Admin" action="#{feedbackBean.openFeedbackAdminPopup}" 
							immediate="false" style="float: right; text-decoration: underline; color: silver;"/>	
						<ice:panelPopup id="popupAdminFeedback" modal="false" rendered="#{feedbackBean.feedbackAdminRendered}"
							autoCentre="true">
							<f:facet name="header">
								<ice:outputText value="MetFusion Feedback Admin"/>
								<ice:commandButton image="images/close.png" action="#{feedbackBean.closeFeedbackAdminPopup}" 
									immediate="false" style="float: right;"/>
							</f:facet>
							
							<f:facet name="body">
								<!-- this single outer panelGroup is required in order to render the content properly -->
								<ice:panelGroup>
								<ice:panelGroup id="feedbackAdminLogin" rendered="#{!feedbackBean.authorized}">
									<ice:panelGrid columns="2">
										<ice:outputLabel id="labelFeedbackAdminUser" value="Username:" for="textFeedbackAdminUser"/>
										<ice:inputText id="textFeedbackAdminUser" value="#{feedbackBean.providedName}"/>

										<ice:outputLabel id="labelFeedbackAdminPass" value="Password:" for="textFeedbackAdminPass"/>
										<ice:inputSecret id="textFeedbackAdminPass" value="#{feedbackBean.providedPass}" action="#{feedbackBean.loginAdmin}"/>

										<ice:commandButton id="buttonFeedbackAdminLogin" value="Login" action="#{feedbackBean.loginAdmin}"/>
										<ice:outputText id="errorFeedbackAdminLogin" value="#{feedbackBean.loginError}" style="color: red;"/>
									</ice:panelGrid>
								</ice:panelGroup>
								
								<ice:panelGroup id="feedbackAdminData" rendered="#{feedbackBean.authorized}">
									<ice:dataTable id="feedbackTable" value="#{feedbackBean.feedbackEntries}" var="entry"
										rendered="#{feedbackBean.authorized}" rows="10">
										<ice:column>
											<f:facet name="header">
												Date
											</f:facet>
											#{entry.date}
										</ice:column>
										<ice:column>
											<f:facet name="header">
												Contact
											</f:facet>
											#{entry.name}
											<br/>
											#{entry.email}
										</ice:column>
										<ice:column>
											<f:facet name="header">
												Comment
											</f:facet>
											#{entry.comment}
										</ice:column>
										<ice:column>
											<f:facet name="header">
												Answered
											</f:facet>
											#{entry.answered}
										</ice:column>
										<ice:column>
											<f:facet name="header">
												Fixed
											</f:facet>
											#{entry.fixed}
										</ice:column>
										<ice:column>
											<f:facet name="header">
												Actions
											</f:facet>
											<ice:commandLink value="Show Values" style="text-decoration: underline;"
												actionListener="#{feedbackBean.feedbackRowSelectionListener}">
												<f:attribute name="currentFeedbackEntry" value="#{entry}"/>
											</ice:commandLink>
										</ice:column>
									</ice:dataTable>
									
									<ice:dataPaginator id="feedbackTablePaginator" for="feedbackTable" fastStep="10"
						                         pageCountVar="pageCount" pageIndexVar="pageIndex" paginator="true" 
						                         paginatorMaxPages="9" rendered="#{feedbackBean.authorized}">
										<f:facet name="first" >
						                	<ice:graphicImage url="#{msgs.xpDataPaginatorFirst}" style="border:none;"/>
						                </f:facet>
						                <f:facet name="last">
						                	<ice:graphicImage url="#{msgs.xpDataPaginatorLast}" style="border:none;" />
						                </f:facet>
						                <f:facet name="previous">
						                	<ice:graphicImage url="#{msgs.xpDataPaginatorPrevious}" style="border:none;" />
						                </f:facet>
						                <f:facet name="next">
						                	<ice:graphicImage url="#{msgs.xpDataPaginatorNext}" style="border:none;" />
						                </f:facet>
						                <f:facet name="fastforward">
						                	<ice:graphicImage url="#{msgs.xpDataPaginatorFastforward}" style="border:none;" />
						                </f:facet>
						                <f:facet name="fastrewind">
						                	<ice:graphicImage url="#{msgs.xpDataPaginatorFastrewind}" style="border:none;" />
						                </f:facet>
									</ice:dataPaginator>
									
									<ice:commandButton value="Logout" action="#{feedbackBean.closeFeedbackAdminPopup}"/>
									<ice:outputText value="#{feedbackBean.adminNote}" style="color: LimeGreen; float: right;"
										rendered="#{feedbackBean.renderAdminNote}"/>
									<ice:outputText value="#{feedbackBean.adminNote}" style="color: red; float: right;"
										rendered="#{!feedbackBean.renderAdminNote}"/>
								</ice:panelGroup>
								</ice:panelGroup>
							</f:facet>
						</ice:panelPopup>
					</div>
			    </ice:panelTab>
			    
			    <ice:panelTab label="Query Results" rendered="#{appBean.showTable}">
			    	<ice:selectOneRadio value="#{appBean.selectedResult}" partialSubmit="true" rendered="#{appBean.showTable}">
						<f:selectItem itemLabel="MetFusion Cluster" itemValue="cluster" itemDisabled="#{!appBean.showClusterResults}"/>
						<f:selectItem itemLabel="Fragmenter List" itemValue="fragmenter" itemDisable="#{!appBean.showResultsFragmenter}"/>
						<f:selectItem itemLabel="Database List" itemValue="database" itemDisabled="#{!appBean.showResultsDatabase}"/>
						<f:selectItem itemLabel="Unused Database Entries" itemValue="unused" itemDisabled="#{!appBean.mblb.showNote}"/>
					</ice:selectOneRadio>
					
					<ice:panelGroup style="background-color: MintCream; border: 1px solid ForestGreen;" rendered="#{appBean.createdResource}">
						<ice:panelGrid columns="2">
						<ice:outputText value="Export results into Excel file:"/>
						<ice:outputResource id="outputResource" resource="#{appBean.outputResource}"
							label="Save results in Excel document." mimeType="application/vnd.ms-excel"
							fileName="#{appBean.outputResource.resourceName}" image="/images/icons/xls.png" rendered="#{appBean.createdResource}"/>
						</ice:panelGrid>
    				</ice:panelGroup>
      						
					<ice:panelStack selectedPanel="#{appBean.selectedResult}">
						<ice:panelGroup id="cluster">
							<ice:dataTable id="tableCluster" value="#{appBean.tanimotoClusters}" rendered="#{appBean.showClusterResults}" 
								var="entry" rows="20">
								<f:facet name="header">
									<ice:outputLabel value="MetFusion - Tanimoto Clustering Ranking" />
								</f:facet>
								<!-- contract/expand column -->
								<ice:column>
									<ice:panelGroup styleClass="#{entry.indentStyleClass}">
										<!-- Render the expand/contract if there is an image -->
										<ice:commandLink actionListener="#{entry.toggleSubGroupAction}">
											<ice:graphicImage id="expandContractImage"
												value="#{entry.expandContractImage}"
												style="border: 0px solid;" />
										</ice:commandLink>
									</ice:panelGroup>
								</ice:column>
								<ice:column>
									<f:facet name="header">Port Name</f:facet>
										#{entry.port}
									</ice:column>
								<ice:column>
									<f:facet name="header">Record ID</f:facet>
									<ice:outputLink id="linkOut" value="#{entry.url}" target="_blank" style="text-decoration: underline;">
										<ice:outputText id="rowData" value="#{entry.id}" nospan="true"/>
									</ice:outputLink>
			<!--						#{entry.id}-->
								</ice:column>
								<ice:column>
									<f:facet name="header">Compound Name</f:facet>
									#{entry.name}
								</ice:column>
								<ice:column>
									<f:facet name="header">Exact Mass</f:facet>
									<ice:outputText value="#{entry.sumFormula}" escape="false"></ice:outputText>
									<br/><br/>
									#{entry.exactMass}
								</ice:column>
								<ice:column>
									<f:facet name="header">Structure</f:facet>
									<ice:graphicImage value="#{entry.imagePath}" alt="Structure"/>
								</ice:column>
								<ice:column>
									<f:facet name="header">Score</f:facet>
									<ice:outputText value="#{entry.score}">
										<f:convertNumber maxFractionDigits="3"/>
									</ice:outputText>
									<br/><br/>
									<ice:outputFormat value="Peaks explained: {0}">
										<f:param value="#{entry.matchingPeaks}"/>
									</ice:outputFormat>
								</ice:column>
								<ice:column>
									<f:facet name="header">Integration Score</f:facet>
									<ice:outputText value="#{entry.resultScore}">
										<f:convertNumber maxFractionDigits="3"/>
									</ice:outputText>
<!--									<ice:graphicImage alt="Position change" url="#{entry.flag}" style="margin-left:3px; float: right;"/>-->
								</ice:column>
								<ice:column>
									<f:facet name="header">Fragments</f:facet>
									<ice:outputLink value="#{entry.landingURL}" target="_blank" style="text-decoration: underline;">
										<ice:outputText value="Compute Fragments" nospan="true"/>
									</ice:outputLink>
								</ice:column>
							</ice:dataTable>
							
							<ice:panelGrid columns="1" styleClass="scrollerTable2" columnClasses="standardTable_ColumnCentered" >
			 
						        <ice:dataPaginator id="scroll_1_cluster" for="tableCluster" fastStep="10"
						                         pageCountVar="pageCount" pageIndexVar="pageIndex"
						                         paginator="true" paginatorMaxPages="9" rendered="#{appBean.showClusterResults}" >
						                <f:facet name="first" >
						                	<ice:graphicImage url="#{msgs.xpDataPaginatorFirst}" style="border:none;"/>
						                </f:facet>
						                <f:facet name="last">
						                	<ice:graphicImage url="#{msgs.xpDataPaginatorLast}" style="border:none;" />
						                </f:facet>
						                <f:facet name="previous">
						                	<ice:graphicImage url="#{msgs.xpDataPaginatorPrevious}" style="border:none;" />
						                </f:facet>
						                <f:facet name="next">
						                	<ice:graphicImage url="#{msgs.xpDataPaginatorNext}" style="border:none;" />
						                </f:facet>
						                <f:facet name="fastforward">
						                	<ice:graphicImage url="#{msgs.xpDataPaginatorFastforward}" style="border:none;" />
						                </f:facet>
						                <f:facet name="fastrewind">
						                	<ice:graphicImage url="#{msgs.xpDataPaginatorFastrewind}" style="border:none;" />
						                </f:facet>
						        </ice:dataPaginator>
						 
						        <ice:dataPaginator id="scroll_2_cluster" for="tableCluster" rendered="#{appBean.showClusterResults}" 
						                        rowsCountVar="rowsCount" displayedRowsCountVar="displayedRowsCountVar"
						                        firstRowIndexVar="firstRowIndex" lastRowIndexVar="lastRowIndex"
						                        pageCountVar="pageCount" pageIndexVar="pageIndex">
						 
						                 <ice:outputFormat styleClass="standard"
						                 	value="{0} candidates found, displaying {1} candidates from {2} to {3}. Page {4} / {5}">
						                        <f:param value="#{rowsCount}" />
						                        <f:param value="#{displayedRowsCountVar}" />
						                        <f:param value="#{firstRowIndex}" />
						                        <f:param value="#{lastRowIndex}" />
						                        <f:param value="#{pageIndex}" />
						                        <f:param value="#{pageCount}" />
						                </ice:outputFormat>
						 
						        </ice:dataPaginator>
						 
						    </ice:panelGrid>
						</ice:panelGroup>
						
						<ice:panelGroup id="fragmenter">
							<ice:dataTable id="fragmenterList" value="#{appBean.mfb.results}" 
								rendered="#{appBean.mfb.showResult}" var="entry" rows="20">
								<f:facet name="header">
									<ice:outputText value="Original Candidate Ranking" />
								</f:facet>
								<ice:column>
									<f:facet name="header">Port Name</f:facet>
									#{entry.port}
								</ice:column>
								<ice:column>
									<f:facet name="header">Record ID</f:facet>
									<ice:outputLink id="linkOut" value="#{entry.url}" target="_blank" style="text-decoration: underline;">
										<ice:outputText id="rowData" value="#{entry.id}" nospan="true"/>
									</ice:outputLink>
								</ice:column>
								<ice:column>
									<f:facet name="header">Compound Name</f:facet>
									#{entry.name}
<!--									<br/>-->
<!--									#{entry.smiles}-->
								</ice:column>
								<ice:column>
									<f:facet name="header">Exact Mass</f:facet>
									<ice:outputText value="#{entry.sumFormula}" escape="false"></ice:outputText>
									<br/><br/>
									#{entry.exactMass}
								</ice:column>
								<ice:column>
									<f:facet name="header">Structure</f:facet>
									<ice:graphicImage value="#{entry.imagePath}" alt="Structure"/>
								</ice:column>
								<ice:column>
									<f:facet name="header">Score</f:facet>
									#{entry.score}
									<br/><br/>
									<ice:outputFormat value="Peaks explained: {0}">
										<f:param value="#{entry.matchingPeaks}"/>
									</ice:outputFormat>
								</ice:column>
								<ice:column>
									<f:facet name="header">Fragments</f:facet>
									<ice:outputLink value="#{entry.landingURL}" target="_blank" style="text-decoration: underline;">
										<ice:outputText value="Compute Fragments" nospan="true"/>
									</ice:outputLink>
								</ice:column>
							</ice:dataTable>
							
							<ice:panelGrid columns="1" styleClass="scrollerTable2" columnClasses="standardTable_ColumnCentered" >
						        <ice:dataPaginator id="scroll_1_fragmenter" for="fragmenterList" fastStep="10"
						                         pageCountVar="pageCount" pageIndexVar="pageIndex"
						                         paginator="true" paginatorMaxPages="9" rendered="#{appBean.mfb.showResult}">
						                <f:facet name="first" >
						                         <ice:graphicImage url="#{msgs.xpDataPaginatorFirst}" style="border:none;"/>
						                </f:facet>
						                <f:facet name="last">
						                        <ice:graphicImage url="#{msgs.xpDataPaginatorLast}" style="border:none;" />
						                </f:facet>
						                <f:facet name="previous">
						                        <ice:graphicImage url="#{msgs.xpDataPaginatorPrevious}" style="border:none;" />
						                </f:facet>
						                <f:facet name="next">
						                        <ice:graphicImage url="#{msgs.xpDataPaginatorNext}" style="border:none;" />
						                </f:facet>
						                <f:facet name="fastforward">
						                        <ice:graphicImage url="#{msgs.xpDataPaginatorFastforward}" style="border:none;" />
						                </f:facet>
						                <f:facet name="fastrewind">
						                        <ice:graphicImage url="#{msgs.xpDataPaginatorFastrewind}" style="border:none;" />
						                </f:facet>
						        </ice:dataPaginator>
						 
						        <ice:dataPaginator id="scroll_2_fragmenter" for="fragmenterList" rendered="#{appBean.mfb.showResult}" 
						                        rowsCountVar="rowsCount" displayedRowsCountVar="displayedRowsCountVar"
						                        firstRowIndexVar="firstRowIndex" lastRowIndexVar="lastRowIndex"
						                        pageCountVar="pageCount" pageIndexVar="pageIndex">
						                 <ice:outputFormat value="{0} candidates found, displaying {1} candidates from {2} to {3}. Page {4} / {5}" styleClass="standard" >
						                        <f:param value="#{rowsCount}" />
						                        <f:param value="#{displayedRowsCountVar}" />
						                        <f:param value="#{firstRowIndex}" />
						                        <f:param value="#{lastRowIndex}" />
						                        <f:param value="#{pageIndex}" />
						                        <f:param value="#{pageCount}" />
						                </ice:outputFormat>
						        </ice:dataPaginator>
						    </ice:panelGrid>
						</ice:panelGroup>
						
						<ice:panelGroup id="database">
							<ice:dataTable id="databaseList" value="#{appBean.mblb.results}"
								rendered="#{appBean.mblb.showResult}" var="entry" rows="20">
								<f:facet name="header">
									<ice:outputText value="Original Database Ranking" />
								</f:facet>
								
								<ice:column>
									<f:facet name="header">Port Name</f:facet>
									#{entry.port}
								</ice:column>
								<ice:column>
									<f:facet name="header">Record ID</f:facet>
									<ice:outputLink id="linkOut" value="#{entry.url}" target="_blank" style="text-decoration: underline;">
										<ice:outputText id="rowData" value="#{entry.id}" nospan="true"/>
									</ice:outputLink>
								</ice:column>
								<ice:column>
									<f:facet name="header">Compound Name</f:facet>
									#{entry.name}
<!--									#{entry.smiles}-->
								</ice:column>
								<ice:column>
									<f:facet name="header">Exact Mass</f:facet>
									<ice:outputText value="#{entry.sumFormula}" escape="false"></ice:outputText>
									<br/><br/>
									#{entry.exactMass}
								</ice:column>
								<ice:column>
									<f:facet name="header">Structure</f:facet>
									<ice:graphicImage value="#{entry.imagePath}" alt="Structure"/>
								</ice:column>
								<ice:column>
									<f:facet name="header">Score</f:facet>
									#{entry.score}
								</ice:column>
							</ice:dataTable>
							
							<ice:panelGrid columns="1" styleClass="scrollerTable2" columnClasses="standardTable_ColumnCentered" >
						        <ice:dataPaginator id="scroll_1_database" for="databaseList" fastStep="10"
						                         pageCountVar="pageCount" pageIndexVar="pageIndex"
						                         paginator="true" paginatorMaxPages="9" rendered="#{appBean.mfb.showResult}" >
						                <f:facet name="first" >
						                         <ice:graphicImage url="#{msgs.xpDataPaginatorFirst}" style="border:none;"/>
						                </f:facet>
						                <f:facet name="last">
						                        <ice:graphicImage url="#{msgs.xpDataPaginatorLast}" style="border:none;" />
						                </f:facet>
						                <f:facet name="previous">
						                        <ice:graphicImage url="xmlhttp/css/xp/css-images/arrow-previous.gif" style="border:none;" />
						                </f:facet>
						                <f:facet name="next">
						                        <ice:graphicImage url="xmlhttp/css/xp/css-images/arrow-next.gif" style="border:none;" />
						                </f:facet>
						                <f:facet name="fastforward">
						                        <ice:graphicImage url="xmlhttp/css/xp/css-images/arrow-ff.gif" style="border:none;" />
						                </f:facet>
						                <f:facet name="fastrewind">
						                        <ice:graphicImage url="xmlhttp/css/xp/css-images/arrow-fr.gif" style="border:none;" />
						                </f:facet>
						        </ice:dataPaginator>
						 
						        <ice:dataPaginator id="scroll_2_database" for="databaseList" rendered="#{appBean.mfb.showResult}" 
						                        rowsCountVar="rowsCount" displayedRowsCountVar="displayedRowsCountVar"
						                        firstRowIndexVar="firstRowIndex" lastRowIndexVar="lastRowIndex"
						                        pageCountVar="pageCount" pageIndexVar="pageIndex">
						                 <ice:outputFormat value="{0} candidates found, displaying {1} candidates from {2} to {3}. Page {4} / {5}" styleClass="standard" >
						                        <f:param value="#{rowsCount}" />
						                        <f:param value="#{displayedRowsCountVar}" />
						                        <f:param value="#{firstRowIndex}" />
						                        <f:param value="#{lastRowIndex}" />
						                        <f:param value="#{pageIndex}" />
						                        <f:param value="#{pageCount}" />
						                </ice:outputFormat>
						        </ice:dataPaginator>
						    </ice:panelGrid>
						</ice:panelGroup>
						
						<ice:panelGroup id="unused">
			    			<ice:dataTable value="#{appBean.mblb.unused}" var="entry" id="unusedMassBankEntries" rows="20">
			    				<f:facet name="header">
			    					<ice:outputText value="Unused MassBank Entries"/>
			    				</f:facet>
			    				<ice:column>
									<f:facet name="header">Port Name</f:facet>
									#{entry.port}
								</ice:column>
								<ice:column>
									<f:facet name="header">Record ID</f:facet>
									<ice:outputLink id="linkOut" value="#{entry.url}" target="_blank" style="text-decoration: underline;">
										<ice:outputText id="rowData" value="#{entry.id}" nospan="true"/>
									</ice:outputLink>
								</ice:column>
								<ice:column>
									<f:facet name="header">Compound Name</f:facet>
									#{entry.name}
<!--									#{entry.smiles}-->
								</ice:column>
								<ice:column>
									<f:facet name="header">Exact Mass</f:facet>
									<ice:outputText value="#{entry.sumFormula}" escape="false"></ice:outputText>
									<br/><br/>
									#{entry.exactMass}
								</ice:column>
								<ice:column>
									<f:facet name="header">Structure</f:facet>
									<ice:graphicImage value="#{entry.imagePath}" alt="Structure"/>
								</ice:column>
								<ice:column>
									<f:facet name="header">Score</f:facet>
									#{entry.score}
								</ice:column>
			    			</ice:dataTable>
			    			
			    			<ice:panelGrid columns="1" styleClass="scrollerTable2" columnClasses="standardTable_ColumnCentered" >
						        <ice:dataPaginator id="scroll_1_unused" for="unusedMassBankEntries" fastStep="10"
						                         pageCountVar="pageCount" pageIndexVar="pageIndex"
						                         paginator="true" paginatorMaxPages="9" rendered="#{appBean.mfb.showResult}" >
						                <f:facet name="first" >
						                         <ice:graphicImage url="#{msgs.xpDataPaginatorFirst}" style="border:none;"/>
						                </f:facet>
						                <f:facet name="last">
						                        <ice:graphicImage url="#{msgs.xpDataPaginatorLast}" style="border:none;" />
						                </f:facet>
						                <f:facet name="previous">
						                        <ice:graphicImage url="xmlhttp/css/xp/css-images/arrow-previous.gif" style="border:none;" />
						                </f:facet>
						                <f:facet name="next">
						                        <ice:graphicImage url="xmlhttp/css/xp/css-images/arrow-next.gif" style="border:none;" />
						                </f:facet>
						                <f:facet name="fastforward">
						                        <ice:graphicImage url="xmlhttp/css/xp/css-images/arrow-ff.gif" style="border:none;" />
						                </f:facet>
						                <f:facet name="fastrewind">
						                        <ice:graphicImage url="xmlhttp/css/xp/css-images/arrow-fr.gif" style="border:none;" />
						                </f:facet>
						        </ice:dataPaginator>
						 
						        <ice:dataPaginator id="scroll_2_unused" for="unusedMassBankEntries" rendered="#{appBean.mfb.showResult}" 
						                        rowsCountVar="rowsCount" displayedRowsCountVar="displayedRowsCountVar"
						                        firstRowIndexVar="firstRowIndex" lastRowIndexVar="lastRowIndex"
						                        pageCountVar="pageCount" pageIndexVar="pageIndex">
						                 <ice:outputFormat value="{0} results unused, displaying {1} results from {2} to {3}. Page {4} / {5}" styleClass="standard" >
						                        <f:param value="#{rowsCount}" />
						                        <f:param value="#{displayedRowsCountVar}" />
						                        <f:param value="#{firstRowIndex}" />
						                        <f:param value="#{lastRowIndex}" />
						                        <f:param value="#{pageIndex}" />
						                        <f:param value="#{pageCount}" />
						                </ice:outputFormat>
						        </ice:dataPaginator>
						    </ice:panelGrid>
						</ice:panelGroup>
					</ice:panelStack>
					
			    	
				</ice:panelTab>
				
			    <ice:panelTab label="Similarity Matrix" rendered="#{appBean.showResultTable}">
			    	<!-- Controls to change stacking panels -->
			    	<ice:panelGroup style="width:40%; border: 1px solid silver;">
				    	<ice:selectOneRadio id="mainRadio" value="#{appBean.selectedMatrixPanel}"
	                    		partialSubmit="true" accesskey="S">
			                <f:selectItem
			                        itemValue="origSimMatrix"
			                        itemLabel="Original Similarity Matrix"/>
			                <f:selectItem
			                        itemValue="newSimMatrix"
			                        itemLabel="Reranked Similarity Matrix"/>
			            </ice:selectOneRadio>
			    	</ice:panelGroup>
			    	
			    	<ice:panelStack id="stackingMatrices" selectedPanel="#{appBean.selectedMatrixPanel}">
						<ice:panelGroup id="origSimMatrix" styleClass="exampleBox columnsTableContainer" rendered="#{appBean.mblb.showResult}">
							<div style="width:1400px; overflow:auto;">
							<!-- dataTable with columns component -->
							<ice:dataTable id="dataTbl" var="item" rendered="#{appBean.mfb.showResult}"
								value="#{appBean.colorMatrix.rowDataModel}"
								columnClasses="columnsColumn" rows="20" style="padding:0;">
					
								<ice:column>
									<f:facet name="header">MetFrag\MassBank Compounds</f:facet>
									<ice:panelGroup style="text-align: center; white-space: nowrap;" panelTooltip="candidateTooltip">
										<ice:outputLink id="linkOut" target="_blank"
											value="#{appBean.mfb.results[item].url}">
											<ice:outputText id="candidate"
												value="#{appBean.mfb.results[item].id}"/>
										</ice:outputLink>
									</ice:panelGroup>
									<ice:panelTooltip id="candidateTooltip">
										<f:facet name="header">
											<ice:outputText value="#{appBean.mfb.results[item].name}"/>
										</f:facet>
										<f:facet name="body">
											<ice:panelGrid columns="2">
												<ice:graphicImage alt="compound image" url="#{appBean.mfb.results[item].imagePath}"/>
												<ice:panelGroup style="margin-left: 5px; border: 1px solid silver; padding: 5px;">
													<ice:panelGrid columns="2">
														<ice:outputLabel id="lblMtrxRankOld" for="txtMtrxRankOld" value="Tied Rank:"/>
														<ice:outputText id="txtMtrxRankOld" value="#{appBean.mfb.results[item].tiedRank}"/>
														<ice:outputLabel id="lblMtrxScoreOld" for="txtMtrxScoreOld" value="MetFrag Score:"/>
														<ice:outputText id="txtMtrxScoreOld" value="#{appBean.mfb.results[item].score}"/>
													</ice:panelGrid>
												</ice:panelGroup>
											</ice:panelGrid>
										</f:facet>
									</ice:panelTooltip>
								</ice:column>
	
								<ice:columns id="columnDataModel"
									value="#{appBean.colorMatrix.columnDataModel}" var="column">
									<f:facet name="header">
										<ice:panelGroup style="text-align: center; white-space: nowrap;">
											<ice:outputLink id="linkOut"
												value="#{appBean.colorMatrix.columnDataModel.rowData.url}"
												target="_blank">
												<ice:outputText id="rowData"
													value="#{appBean.colorMatrix.columnDataModel.rowData.id}"
													nospan="true" />
											</ice:outputLink>
										</ice:panelGroup>
									</f:facet>
									
									<!-- display the table cell values-->
									<ice:panelGroup style="text-align: center; white-space: nowrap;">
										<ice:outputText id="cellValue"
											value="#{appBean.colorMatrix.cellValue.valueShort}"
											style="background-color:#{appBean.colorMatrix.cellValue.color}; padding: 2px;" />
									</ice:panelGroup>
								</ice:columns>
							</ice:dataTable>
							</div>
							<ice:dataPaginator id="scroll_1_tan" for="dataTbl" fastStep="10"
								pageCountVar="pageCount" pageIndexVar="pageIndex"
								paginator="true" paginatorMaxPages="9" rendered="#{appBean.mfb.showResult}">
								<f:facet name="first">
									<ice:graphicImage url="#{msgs.xpDataPaginatorFirst}" style="border:none;"/>
								</f:facet>
								<f:facet name="last">
									<ice:graphicImage url="#{msgs.xpDataPaginatorLast}" style="border:none;"/>
								</f:facet>
								<f:facet name="previous">
									<ice:graphicImage url="#{msgs.xpDataPaginatorPrevious}"	style="border:none;"/>
								</f:facet>
								<f:facet name="next">
									<ice:graphicImage url="#{msgs.xpDataPaginatorNext}"	style="border:none;"/>
								</f:facet>
								<f:facet name="fastforward">
									<ice:graphicImage url="#{msgs.xpDataPaginatorFastforward}" style="border:none;"/>
								</f:facet>
								<f:facet name="fastrewind">
									<ice:graphicImage url="#{msgs.xpDataPaginatorFastrewind}" style="border:none;"/>
								</f:facet>
							</ice:dataPaginator>
							<ice:dataPaginator id="scroll_2_tan" for="dataTbl" rendered="#{appBean.mfb.showResult}" 
		                        rowsCountVar="rowsCount" displayedRowsCountVar="displayedRowsCountVar"
		                        firstRowIndexVar="firstRowIndex" lastRowIndexVar="lastRowIndex"
		                        pageCountVar="pageCount" pageIndexVar="pageIndex">
				                 <ice:outputFormat value="{0} candidates found, displaying {1} candidates from {2} to {3}. Page {4} / {5}" 
				                 	styleClass="standard" >
			                        <f:param value="#{rowsCount}" />
			                        <f:param value="#{displayedRowsCountVar}" />
			                        <f:param value="#{firstRowIndex}" />
			                        <f:param value="#{lastRowIndex}" />
			                        <f:param value="#{pageIndex}" />
			                        <f:param value="#{pageCount}" />
				                </ice:outputFormat>
					        </ice:dataPaginator>
			    		</ice:panelGroup>
			    		
			    		<!-- newly computed MetFusion Tanimoto similarity matrix -->
			    		<ice:panelGroup id="newSimMatrix">
								<div style="width:1400px; overflow:auto;">
								<!-- dataTable with columns component -->
								<ice:dataTable id="dataTbl2" var="item" rendered="#{appBean.mfb.showResult}"
									value="#{appBean.colorMatrixAfter.rowDataModel}"
									columnClasses="columnsColumn" rows="20" style="padding:0;">
						
									<ice:column>
										<f:facet name="header">MetFrag\MassBank Compounds</f:facet>
										<ice:panelGroup style="text-align: center; white-space: nowrap;" panelTooltip="candidateTooltip">
											<ice:outputLink id="linkOut" target="_blank"
												value="#{appBean.secondOrder[item].url}">
												<ice:outputText id="candidate"
													value="#{appBean.secondOrder[item].id}"/>
											</ice:outputLink>
										</ice:panelGroup>
										<ice:panelTooltip id="candidateTooltip">
												<f:facet name="header">
													<ice:outputText value="#{appBean.secondOrder[item].name}"/>
												</f:facet>
												<f:facet name="body">
													<ice:panelGrid columns="2">
														<ice:graphicImage alt="compound image" url="#{appBean.secondOrder[item].imagePath}"/>
														<ice:panelGroup style="margin-left: 5px; border: 1px solid silver; padding: 5px;">
															<ice:panelGrid columns="2">
																<ice:outputLabel id="lblMtrxRankNew" for="txtMtrxRankNew" value="Tied Rank:"/>
																<ice:outputText id="txtMtrxRankNew" value="#{appBean.secondOrder[item].tiedRank}"/>
																<ice:outputLabel id="lblMtrxScoreNew" for="txtMtrxScoreNew" value="MetFusion Score:"/>
																<ice:outputText id="txtMtrxScoreNew" value="#{appBean.secondOrder[item].resultScore}"/>
															</ice:panelGrid>
														</ice:panelGroup>
													</ice:panelGrid>
												</f:facet>
											</ice:panelTooltip>
									</ice:column>
		
									<ice:columns id="columnDataModel2"
										value="#{appBean.colorMatrixAfter.columnDataModel}" var="column">
										<f:facet name="header">
											<ice:panelGroup>
												<ice:outputLink id="linkOut"
													value="#{appBean.colorMatrixAfter.columnDataModel.rowData.url}"
													target="_blank">
													<ice:outputText id="rowData"
														value="#{appBean.colorMatrixAfter.columnDataModel.rowData.id}"
														nospan="true" />
												</ice:outputLink>
											</ice:panelGroup>
										</f:facet>
										<!-- display the table cell values-->
										<ice:panelGroup style="text-align: center; white-space: nowrap;">
											<ice:outputText id="cellValue"
												value="#{appBean.colorMatrixAfter.cellValue.valueShort}"
												style="background-color:#{appBean.colorMatrixAfter.cellValue.color}; padding: 2px;" />
										</ice:panelGroup>
									</ice:columns>
								</ice:dataTable>
								</div>
								<ice:dataPaginator id="scroll_1_tan2" for="dataTbl2" fastStep="10"
									pageCountVar="pageCount" pageIndexVar="pageIndex"
									paginator="true" paginatorMaxPages="9" rendered="#{appBean.mblb.showResult}">
									<f:facet name="first">
										<ice:graphicImage url="#{msgs.xpDataPaginatorFirst}" style="border:none;"/>
									</f:facet>
									<f:facet name="last">
										<ice:graphicImage url="#{msgs.xpDataPaginatorLast}" style="border:none;"/>
									</f:facet>
									<f:facet name="previous">
										<ice:graphicImage url="#{msgs.xpDataPaginatorPrevious}"	style="border:none;"/>
									</f:facet>
									<f:facet name="next">
										<ice:graphicImage url="#{msgs.xpDataPaginatorNext}"	style="border:none;"/>
									</f:facet>
									<f:facet name="fastforward">
										<ice:graphicImage url="#{msgs.xpDataPaginatorFastforward}" style="border:none;"/>
									</f:facet>
									<f:facet name="fastrewind">
										<ice:graphicImage url="#{msgs.xpDataPaginatorFastrewind}" style="border:none;"/>
									</f:facet>
								</ice:dataPaginator>
								<ice:dataPaginator id="scroll_2_tan2" for="dataTbl2" rendered="#{appBean.mfb.showResult}" 
			                        rowsCountVar="rowsCount" displayedRowsCountVar="displayedRowsCountVar"
			                        firstRowIndexVar="firstRowIndex" lastRowIndexVar="lastRowIndex"
			                        pageCountVar="pageCount" pageIndexVar="pageIndex">
				                	<ice:outputFormat value="{0} candidates found, displaying {1} candidates from {2} to {3}. Page {4} / {5}" 
					                 	styleClass="standard" >
				                        <f:param value="#{rowsCount}" />
				                        <f:param value="#{displayedRowsCountVar}" />
				                        <f:param value="#{firstRowIndex}" />
				                        <f:param value="#{lastRowIndex}" />
				                        <f:param value="#{pageIndex}" />
				                        <f:param value="#{pageCount}" />
				                	</ice:outputFormat>
					        </ice:dataPaginator>
			    		</ice:panelGroup>
			    	</ice:panelStack>
			    </ice:panelTab>
			    
			    <ice:panelTab label="Error/Log" rendered="#{!(appBean.errorMessage.length() == 0)} | #{appBean.mblb.showNote}">
			    	<ice:panelGroup>
			    		<ice:outputText value="#{appBean.errorMessage}" rendered="#{!(appBean.errorMessage.length() == 0)}"></ice:outputText>
			    	</ice:panelGroup>
			    	<ice:panelGroup>
			    		<ice:outputText value="#{appBean.mblb.missingEntriesNote}" rendered="#{appBean.mblb.showNote}"></ice:outputText>
			    	</ice:panelGroup>
			    </ice:panelTab>
			    
			    <ice:panelTab label="Information">
			    	<ice:panelGroup>
			    		<ice:panelCollapsible expanded="true">
			    			<f:facet name="header">
			    				<ice:panelGroup>
			    					<ice:outputText value="News"></ice:outputText>
			    				</ice:panelGroup>
			    			</f:facet>
			    			<ice:panelGroup id="pnlGrpNews">
			    				Welcome to <b>MetFusion</b>, an approach to combine the knowledge from spectral databases like 
								<a href="http://www.massbank.jp">MassBank</a> with the multitude of candidates generated
								by fragmenters such as <a href="http://msbi.ipb-halle.de/MetFrag">MetFrag</a>.
								<br/>
								In order to do so, MS2 spectrum information is used to query MassBank and to provide
								fragments for the combinatorical fragmentation to generate candidates that match this
								specific fragmentation pattern.
								<br/>
								Combining both results is done via chemical similarity in terms of the Tanimoto coefficient.
								Using this score in addition to the result scores from MassBank (spectrum similiarity) and
								MetFrag (fragment matching) is now combined and used to rerank the list of fragmenter 
								candidates. This approach shows an improved rank of the correct candidate compared to MetFrag. 
								<hr/>
								<b>News:</b><br/>
								
			    			</ice:panelGroup>
			    		</ice:panelCollapsible>
			    		
			    		<ice:panelCollapsible expanded="false">
			    			<f:facet name="header">
			    				<ice:panelGroup>
			    					<ice:outputText value="Manual"></ice:outputText>
			    				</ice:panelGroup>
			    			</f:facet>
			    			<ice:panelGroup id="pnlGrpManual">
								<b>MetFusion</b> has three different parameter groups, one for MassBank, MetFrag and MetFusion itself.
								<dl>
									<dt>MassBank:</dt>
									<dd>These parameters reflect the <em>MassBank QuickSearch</em> with spectrum information.
									You can choose if your spectrum should be compared against positive, negative or both 
									<em>ionization modes</em>. Additionally, the <em>number of MassBank results</em> can be specified 
									as well as a <em>cutoff for the relative intensities</em>. This option allows to ignore 
									small intensities for spectrum comparison. Finally, the <em>instrument types</em> that were 
									used to measure a reference spectrum can be chosen. These instruments are currently 
									separated into EI, ESI and others groups.</dd>
									<dt>MetFrag:</dt>
									<dd>MetFrag requires an <em>upstream compound database</em> to look up candidate compounds. 
									To do so, an <em>exact mass</em> of the compound of interest needs to be specified. Additonal 
									tweaks to the mass search can be done via <em>search ppm</em>, <em>mz abs</em> and <em>mz ppp</em> 
									parameters. Additionally, the <em>number of candidates</em> can be specified. Further known information 
									about the compound like matching <em>database IDs</em> or the <em>molecular formular</em> can be specified 
									in order to further narrow down the list of provided candidates.</dd>
									<dt>MetFusion:</dt>
									<dd>The MetFusion parameters include the needed spectrum information as <em>peaks</em> and the 
									<em>Tanimoto clustering</em> approach.</dd>
								</dl>		    			
			    			</ice:panelGroup>
			    		</ice:panelCollapsible>
			    	</ice:panelGroup>
			    </ice:panelTab>
			    
			</ice:panelTabSet>
		</div>
		
		<div id="footer">
<!--			<ui:include src="/WEB-INF/inc-content/footer.xhtml"></ui:include>-->
		</div>
		
		<div id="feedback">
			<ice:commandButton id="openFeedbackForm" image="images/Feedback.png" style="display:block; position:fixed; top:600px; right:-1px;"
				action="#{feedbackBean.openFeedbackPopup}" immediate="false"/>
			<ice:panelPopup id="popupFeedback" modal="false" rendered="#{feedbackBean.feedbackRendered}" autoCentre="true">
				<f:facet name="header">
					<ice:outputText value="MetFusion Feedback Form"></ice:outputText>
					<ice:commandButton image="images/close.png" action="#{feedbackBean.closeFeedbackPopup}" 
						immediate="false" style="float: right;"/>
				</f:facet>
				<f:facet name="body">
					<h:panelGrid columns="2"> <!-- columnClasses="feedbackCol" -->
						<ice:outputLabel for="feedbackName" value="Name" />
						<ice:inputText id="feedbackName" value="#{feedbackBean.name}"/>
						
						<ice:outputLabel for="feedbackEmail" value="Email" />
						<ice:inputText id="feedbackEmail" value="#{feedbackBean.email}">
<!--							required="true">-->
<!--							<f:validator validatorId="emailValidator"/>-->
						</ice:inputText>
						
						<ice:outputLabel for="feedbackComment" value="Comment" />
						<ice:inputTextarea id="feedbackComment" value="#{feedbackBean.comment}" rows="10"
							style="width: 300px;" validator="#{feedbackBean.validateFeedback}">
<!--							validator="#{feedbackBean.validateFeedback}"/>-->
<!--							<f:validator validatorId="feedbackValidator"></f:validator>-->
						</ice:inputTextarea>
							
						<ice:outputLabel for="feedbackAllowStorage" value="Allow storage of settings" />
						<ice:selectBooleanCheckbox value="#{feedbackBean.allowStorage}" id="feedbackAllowStorage"
							requiredMessage="You have to allow storage of the current parameter settings in order to submit feedback! (opt-in)"/>
							
						<ice:commandButton id="submitFeedback" actionListener="#{feedbackBean.submit}" value="Send" 
							disabled="#{feedbackBean.hitOnce}"/>
						<ice:panelGroup style="float: right;">
							<ice:outputText style="color: red;" value="#{feedbackBean.error}" rendered="#{!feedbackBean.renderNote}"/>
							<ice:outputText style="color: LimeGreen;" value="#{feedbackBean.note}" rendered="#{feedbackBean.renderNote}"/>
						</ice:panelGroup>
					</h:panelGrid>
				</f:facet>
			</ice:panelPopup>
		</div>
		
	</h:form>
</h:body>
<h:outputStylesheet library="org.icefaces.component.skins" name="rime.css"></h:outputStylesheet>
</html>